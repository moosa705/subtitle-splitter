<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìë§‰ ë¶„í• ê¸°</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 30px;
            font-size: 2.5rem;
        }

        .section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .section h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        textarea {
            width: 100%;
            min-height: 200px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            font-family: monospace;
            resize: vertical;
        }

        textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 20px 0;
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .size-btn {
            background: white;
            color: #333;
            border: 2px solid #ddd;
            padding: 10px 20px;
        }

        .size-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        input[type="number"] {
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            width: 150px;
        }

        input[type="file"] {
            display: none;
        }

        .file-label {
            display: inline-block;
            padding: 12px 24px;
            background: #28a745;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }

        .file-label:hover {
            background: #218838;
        }

        .output-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .output-item {
            background: white;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .output-item:hover {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }

        .output-item.selected {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .output-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-weight: 600;
            color: #667eea;
        }

        .output-content {
            font-size: 13px;
            color: #666;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            font-family: monospace;
        }

        .stats {
            display: flex;
            gap: 20px;
            margin: 20px 0;
            padding: 15px;
            background: #e3f2fd;
            border-radius: 8px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: #667eea;
        }

        .stat-label {
            font-size: 12px;
            color: #666;
            text-transform: uppercase;
        }

        .current-size {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¬ ìë§‰ ë¶„í• ê¸°</h1>

        <!-- ì…ë ¥ ì„¹ì…˜ -->
        <div class="section">
            <h2>ğŸ“ ìë§‰ ì…ë ¥</h2>
            <input type="file" id="fileInput" accept=".txt">
            <label for="fileInput" class="file-label">ğŸ“ íŒŒì¼ ì—…ë¡œë“œ</label>
            <textarea id="inputText" placeholder="ìë§‰ ë‚´ìš©ì„ ì—¬ê¸°ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”..."></textarea>
        </div>

        <!-- ë¶„í•  í¬ê¸° ì„ íƒ -->
        <div class="section">
            <h2>âš™ï¸ ë¶„í•  í¬ê¸° ì„ íƒ<span class="current-size" id="sizeDisplay">400ì</span></h2>
            <div class="controls">
                <button class="size-btn active" onclick="setSize(400)">400ì</button>
                <button class="size-btn" onclick="setSize(600)">600ì</button>
                <button class="size-btn" onclick="setSize(800)">800ì</button>
                <button class="size-btn" onclick="setSize(1000)">1000ì</button>
                <input type="number" id="customSize" placeholder="ì‚¬ìš©ì ì§€ì •" min="100" step="100" onchange="setCustomSize()">
            </div>
            <div class="controls">
                <button class="btn-primary" onclick="splitText()">âœ‚ï¸ ë¶„í• í•˜ê¸°</button>
                <button class="btn-secondary" onclick="clearAll()">ğŸ—‘ï¸ ì´ˆê¸°í™”</button>
            </div>
        </div>

        <!-- í†µê³„ -->
        <div class="stats" id="stats" style="display: none;">
            <div class="stat-item">
                <div class="stat-value" id="totalChars">0</div>
                <div class="stat-label">ì´ ê¸€ììˆ˜</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="sectionCount">0</div>
                <div class="stat-label">ë¶„í•  ê°œìˆ˜</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="fileType">-</div>
                <div class="stat-label">íŒŒì¼ ìœ í˜•</div>
            </div>
        </div>

        <!-- ê²°ê³¼ -->
        <div class="section" id="outputSection" style="display: none;">
            <h2>ğŸ“¦ ë¶„í•  ê²°ê³¼</h2>
            <div class="controls">
                <button class="btn-secondary" onclick="selectAll()">âœ… ì „ì²´ ì„ íƒ</button>
                <button class="btn-secondary" onclick="copySelected()">ğŸ“‹ ì„ íƒ ë³µì‚¬</button>
                <button class="btn-primary" onclick="downloadZip()">ğŸ’¾ ZIP ë‹¤ìš´ë¡œë“œ</button>
            </div>
            <div class="output-grid" id="outputGrid"></div>
        </div>
    </div>

    <script>
        let currentSize = 400;
        let sections = [];
        let selectedSections = new Set();
        let isKorean = false;

        // íŒŒì¼ ì—…ë¡œë“œ
        document.getElementById('fileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('inputText').value = e.target.result;
                };
                reader.readAsText(file);
            }
        });

        // í¬ê¸° ì„¤ì •
        function setSize(size) {
            currentSize = size;
            document.getElementById('sizeDisplay').textContent = size + 'ì';
            document.getElementById('customSize').value = '';
            
            document.querySelectorAll('.size-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
        }

        function setCustomSize() {
            const value = parseInt(document.getElementById('customSize').value);
            if (value && value >= 100) {
                currentSize = value;
                document.getElementById('sizeDisplay').textContent = value + 'ì';
                document.querySelectorAll('.size-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
            }
        }

        // í•œê¸€ ê°ì§€
        function detectKorean(text) {
            return /[ê°€-í£]/.test(text);
        }

        // ë¬¸ì¥ ë ì°¾ê¸°
        function findSentenceEnd(text, startPos, targetSize) {
            const targetPos = Math.min(startPos + targetSize, text.length);
            
            if (targetPos >= text.length) {
                return text.length;
            }

            const minPos = Math.max(startPos + Math.floor(targetSize * 0.8), startPos + 100);
            const maxPos = Math.min(startPos + Math.floor(targetSize * 1.2), text.length);

            const sentenceEnders = ['. ', '.\n', '!"', '?"', '!', '?', 'ã€‚', 'ã€', 'ã€', ')'];

            let bestPos = targetPos;
            let bestScore = Infinity;

            for (let i = minPos; i < maxPos; i++) {
                const char = text[i];
                const nextChar = text[i + 1] || '';
                const twoChars = char + nextChar;

                let isEnder = false;
                for (const ender of sentenceEnders) {
                    if (twoChars.indexOf(ender) === 0 || char === ender) {
                        isEnder = true;
                        break;
                    }
                }

                if (char === '\n' && nextChar === '\n') {
                    isEnder = true;
                }

                if (isEnder) {
                    const distance = Math.abs(i - targetPos);
                    if (distance < bestScore) {
                        bestScore = distance;
                        bestPos = i + 1;
                    }
                }
            }

            if (bestPos === targetPos) {
                for (let i = minPos; i < maxPos; i++) {
                    if (text[i] === '\n') {
                        const distance = Math.abs(i - targetPos);
                        if (distance < bestScore) {
                            bestScore = distance;
                            bestPos = i + 1;
                        }
                    }
                }
            }

            if (bestPos === targetPos) {
                for (let i = minPos; i < maxPos; i++) {
                    if (text[i] === ' ') {
                        const distance = Math.abs(i - targetPos);
                        if (distance < bestScore) {
                            bestScore = distance;
                            bestPos = i + 1;
                        }
                    }
                }
            }

            return bestPos;
        }

        // ë¶„í• í•˜ê¸°
        function splitText() {
            const text = document.getElementById('inputText').value.trim();
            
            if (!text) {
                alert('ìë§‰ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            isKorean = detectKorean(text);
            sections = [];
            selectedSections.clear();

            let currentIndex = 0;
            let sectionNumber = 1;

            while (currentIndex < text.length) {
                const endIndex = findSentenceEnd(text, currentIndex, currentSize);
                const chunk = text.substring(currentIndex, endIndex).trim();
                
                if (chunk.length > 0) {
                    sections.push({
                        number: sectionNumber,
                        content: chunk,
                        charCount: chunk.length
                    });
                    sectionNumber++;
                }
                
                currentIndex = endIndex;
            }

            renderOutput();
            updateStats();
        }

        // ì¶œë ¥ ë Œë”ë§
        function renderOutput() {
            const prefix = isKorean ? 'K' : 'E';
            const grid = document.getElementById('outputGrid');
            
            grid.innerHTML = sections.map((section, index) => `
                <div class="output-item" onclick="toggleSelect(${index})">
                    <div class="output-header">
                        <span>${prefix}-main-${section.number}.txt</span>
                        <span>${section.charCount}ì</span>
                    </div>
                    <div class="output-content">${section.content}</div>
                </div>
            `).join('');

            document.getElementById('outputSection').style.display = 'block';
        }

        // ì„ íƒ í† ê¸€
        function toggleSelect(index) {
            const items = document.querySelectorAll('.output-item');
            
            if (selectedSections.has(index)) {
                selectedSections.delete(index);
                items[index].classList.remove('selected');
            } else {
                selectedSections.add(index);
                items[index].classList.add('selected');
            }
        }

        // ì „ì²´ ì„ íƒ
        function selectAll() {
            selectedSections.clear();
            sections.forEach((_, i) => selectedSections.add(i));
            document.querySelectorAll('.output-item').forEach(el => {
                el.classList.add('selected');
            });
        }

        // ì„ íƒ ë³µì‚¬
        function copySelected() {
            if (selectedSections.size === 0) {
                alert('ë³µì‚¬í•  ì„¹ì…˜ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            const text = Array.from(selectedSections)
                .sort((a, b) => a - b)
                .map(i => sections[i].content)
                .join('\n\n');

            navigator.clipboard.writeText(text).then(() => {
                alert(selectedSections.size + 'ê°œ ì„¹ì…˜ì´ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
            });
        }

        // ZIP ë‹¤ìš´ë¡œë“œ
        async function downloadZip() {
            if (sections.length === 0) return;

            const zip = new JSZip();
            const prefix = isKorean ? 'K' : 'E';

            sections.forEach(section => {
                const filename = prefix + '-main-' + section.number + '.txt';
                zip.file(filename, section.content);
            });

            const blob = await zip.generateAsync({ type: 'blob' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = prefix + '-main-' + String(sections.length).padStart(2, '0') + '.zip';
            a.click();
            URL.revokeObjectURL(url);
        }

        // í†µê³„ ì—…ë°ì´íŠ¸
        function updateStats() {
            const totalChars = sections.reduce((sum, s) => sum + s.charCount, 0);
            document.getElementById('totalChars').textContent = totalChars.toLocaleString();
            document.getElementById('sectionCount').textContent = sections.length;
            document.getElementById('fileType').textContent = isKorean ? 'í•œê¸€' : 'ì˜ë¬¸';
            document.getElementById('stats').style.display = 'flex';
        }

        // ì´ˆê¸°í™”
        function clearAll() {
            document.getElementById('inputText').value = '';
            document.getElementById('fileInput').value = '';
            document.getElementById('outputGrid').innerHTML = '';
            document.getElementById('stats').style.display = 'none';
            document.getElementById('outputSection').style.display = 'none';
            sections = [];
            selectedSections.clear();
        }
    </script>
</body>
</html>
